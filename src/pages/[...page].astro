---
import type { GetStaticPaths } from "astro";
import Pagination from "../components/control/Pagination.astro";
import PostPage from "../components/PostPage.astro";
import { PAGE_SIZE } from "../constants/constants";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { getSortedPosts } from "../utils/content-utils";
import { Icon } from "astro-icon/components"; // è¨˜å¾—å¼•å…¥ Icon

export const getStaticPaths = (async ({ paginate }) => {
    const allBlogPosts = await getSortedPosts();
    return paginate(allBlogPosts, { pageSize: PAGE_SIZE });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const len = page.data.length;

// åˆ¤æ–·æ˜¯å¦ç‚ºç¬¬ä¸€é  (é¦–é )
const isFirstPage = page.url.current === '/' || page.url.current === '';
---

<MainGridLayout>
    {isFirstPage && (
        <div class="relative flex flex-col items-center justify-center min-h-screen w-full -mt-[4rem] mb-8 onload-animation">
            
            <div class="relative group mb-8">
                <div class="absolute -inset-1 bg-gradient-to-r from-[var(--primary)] to-blue-500 rounded-full blur opacity-30 group-hover:opacity-60 transition duration-1000"></div>
                <img src="/avatar.png" class="relative w-40 h-40 rounded-full border-4 border-white dark:border-zinc-900 shadow-2xl mx-auto object-cover" alt="Avatar" />
            </div>

            <h1 class="text-6xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-black to-zinc-600 dark:from-white dark:to-zinc-400">
                Chi Tsai
            </h1>

            <div class="text-2xl text-neutral-500 dark:text-neutral-400 h-10 font-mono font-medium">
                <span id="hero-typewriter"></span>
            </div>

            <div class="absolute bottom-20 animate-bounce cursor-pointer" onclick="window.scrollTo({top: window.innerHeight, behavior: 'smooth'});">
                <Icon name="fa6-solid:chevron-down" class="text-3xl text-neutral-400 hover:text-[var(--primary)] transition"></Icon>
            </div>
        </div>
    )}

    <PostPage page={page}></PostPage>
    <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}></Pagination>
</MainGridLayout>

{isFirstPage && (
    <script>
        import TypeIt from "typeit";
        new TypeIt("#hero-typewriter", {
            speed: 60,
            startDelay: 1000, // é€²å ´å¾Œç­‰ 1 ç§’æ‰é–‹å§‹æ‰“å­—
            loop: true,
            cursor: true,
        })
        .type("æŠ€è¡“å®…æ‹¯æ•‘ä¸–ç•Œ ğŸš€")
        .pause(1500)
        .delete()
        .type("ç†±æ„› iOS & Android å®¢è£½åŒ–")
        .pause(1500)
        .delete()
        .type("æ­¡è¿ä¾†åˆ°æˆ‘çš„å€‹äººç©ºé–“")
        .pause(2000)
        .delete()
        .go();
    </script>
)}