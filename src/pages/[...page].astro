---
import type { GetStaticPaths } from "astro";
import Pagination from "../components/control/Pagination.astro";
import PostPage from "../components/PostPage.astro";
import { PAGE_SIZE } from "../constants/constants";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { getSortedPosts } from "../utils/content-utils";
import { Icon } from "astro-icon/components";
import { profileConfig } from "../config";

export const getStaticPaths = (async ({ paginate }) => {
    const allBlogPosts = await getSortedPosts();
    return paginate(allBlogPosts, { pageSize: PAGE_SIZE });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const len = page.data.length;
const isFirstPage = page.url.current === '/' || page.url.current === '';
---

<MainGridLayout>
    {isFirstPage && (
        <div id="welcome-screen" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white dark:bg-[#121212] transition-transform duration-700 ease-in-out">
            
            <div class="absolute inset-0 overflow-hidden pointer-events-none">
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-[var(--primary)] opacity-10 blur-[100px] rounded-full animate-pulse"></div>
            </div>

            <div class="z-10 flex flex-col items-center text-center">
                <div class="relative group mb-8">
                    <div class="absolute -inset-2 bg-gradient-to-r from-[var(--primary)] to-blue-500 rounded-full blur-xl opacity-20 group-hover:opacity-40 transition duration-1000"></div>
                    <img src={profileConfig.avatar} class="relative w-40 h-40 rounded-full border-4 border-white/50 dark:border-white/10 shadow-2xl mx-auto object-cover transition transform group-hover:scale-105 duration-500" alt="Avatar" />
                </div>

                <h1 class="text-6xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-black to-zinc-600 dark:from-white dark:to-zinc-400 tracking-tight">
                    {profileConfig.name}
                </h1>

                <div class="text-2xl text-neutral-500 dark:text-neutral-400 h-8 font-mono font-medium mb-10">
                    <span id="hero-typewriter"></span>
                </div>

                <div class="flex flex-wrap justify-center gap-4">
                    {profileConfig.links.map(item => (
                        <a href={item.url} target="_blank" rel="noopener noreferrer" aria-label={item.name}
                           class="flex items-center justify-center w-12 h-12 rounded-full bg-black/5 dark:bg-white/10 hover:bg-[var(--primary)] hover:text-white dark:hover:bg-[var(--primary)] backdrop-blur-md transition-all duration-300 hover:scale-110 hover:-translate-y-1">
                            <Icon name={item.icon} class="text-2xl" />
                        </a>
                    ))}
                </div>
            </div>

            <div id="enter-btn" class="absolute bottom-12 cursor-pointer animate-bounce p-4 hover:bg-black/5 dark:hover:bg-white/5 rounded-full transition">
                <Icon name="fa6-solid:chevron-down" class="text-3xl text-neutral-400"></Icon>
            </div>
        </div>
    )}

    <PostPage page={page}></PostPage>
    <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}></Pagination>
</MainGridLayout>

{isFirstPage && (
    <script>
        import TypeIt from "typeit";

        // 1. ÊâìÂ≠óÊ©üË®≠ÂÆö
        new TypeIt("#hero-typewriter", {
            speed: 60,
            startDelay: 1000,
            loop: true,
            cursor: true,
        })
        .type("ÊäÄË°ìÂÆÖÊãØÊïë‰∏ñÁïå üöÄ")
        .pause(1500)
        .delete()
        .type("ÁÜ±ÊÑõ iOS & Android ÂÆ¢Ë£ΩÂåñ")
        .pause(1500)
        .delete()
        .type("Ê∞∏ÈÅ†‰øùÊåÅÂ•ΩÂ•áÂøÉ")
        .pause(2000)
        .delete()
        .go();

        // 2. ÈñãÈñÄ‰∫íÂãïÈÇèËºØ
        const screen = document.getElementById('welcome-screen');
        const btn = document.getElementById('enter-btn');

        // ÂÆöÁæ©Ê∂àÂ§±ÂáΩÂºè
        const dismissScreen = () => {
            if(screen) {
                // ÂæÄ‰∏äÊªëÂãïÊ∂àÂ§±
                screen.style.transform = 'translateY(-100%)';
                // Á≠âÂãïÁï´Ë∑ëÂÆåÂæåÔºåË®≠ÂÆöÁÇ∫‰∏çÂèØË¶ãÔºåÈÅøÂÖçÊìã‰ΩèÈªûÊìä
                setTimeout(() => {
                    screen.style.display = 'none';
                }, 700);
            }
        };

        // ÈªûÊìäÁÆ≠È†≠Ëß∏Áôº
        btn?.addEventListener('click', dismissScreen);

        // (ÈÅ∏Áî®) ÊªæÂãïËß∏ÁôºÔºöÂ¶ÇÊûú‰ΩøÁî®ËÄÖ‰∏ÄÊªæÂãïÊªëÈº†ÔºåÂ∞±Ëá™ÂãïÈñãÈñÄ
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                dismissScreen();
            }
        }, { once: true }); // Âè™Ëß∏Áôº‰∏ÄÊ¨°

    </script>
)}