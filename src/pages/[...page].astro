---
import type { GetStaticPaths } from "astro";
import Pagination from "../components/control/Pagination.astro";
import PostPage from "../components/PostPage.astro";
import { PAGE_SIZE } from "../constants/constants";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { getSortedPosts } from "../utils/content-utils";
import { Icon } from "astro-icon/components";
import { profileConfig } from "../config"; // å¼•å…¥ä½ çš„å€‹äººè¨­å®š

export const getStaticPaths = (async ({ paginate }) => {
    const allBlogPosts = await getSortedPosts();
    return paginate(allBlogPosts, { pageSize: PAGE_SIZE });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const len = page.data.length;

// åˆ¤æ–·æ˜¯å¦ç‚ºç¬¬ä¸€é  (é¦–é )
const isFirstPage = page.url.current === '/' || page.url.current === '';
---

<MainGridLayout>
    {isFirstPage && (
        <div class="relative flex flex-col items-center justify-center min-h-screen w-full -mt-[5.5rem] mb-12 onload-animation z-10">
            
            <div class="relative group mb-8">
                <div class="absolute -inset-2 bg-gradient-to-r from-[var(--primary)] to-blue-500 rounded-full blur-xl opacity-20 group-hover:opacity-40 transition duration-1000 animate-pulse"></div>
                <img src={profileConfig.avatar} class="relative w-40 h-40 rounded-full border-4 border-white/50 dark:border-white/10 shadow-2xl mx-auto object-cover transition transform group-hover:scale-105 duration-500" alt="Avatar" />
            </div>

            <h1 class="text-6xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-black/80 to-black/50 dark:from-white/90 dark:to-white/60 tracking-tight">
                {profileConfig.name}
            </h1>

            <div class="text-2xl text-neutral-500 dark:text-neutral-400 h-8 font-mono font-medium mb-8">
                <span id="hero-typewriter"></span>
            </div>

            <div class="flex flex-wrap justify-center gap-4 mb-16">
                {profileConfig.links.map(item => (
                    <a href={item.url} target="_blank" rel="noopener noreferrer" aria-label={item.name}
                       class="flex items-center justify-center w-12 h-12 rounded-full bg-white/50 dark:bg-black/20 hover:bg-[var(--primary)] hover:text-white dark:hover:bg-[var(--primary)] backdrop-blur-md border border-black/5 dark:border-white/10 transition-all duration-300 hover:scale-110 hover:-translate-y-1 group">
                        <Icon name={item.icon} class="text-2xl opacity-70 group-hover:opacity-100 transition-opacity" />
                    </a>
                ))}
            </div>

            <div class="absolute bottom-12 animate-bounce cursor-pointer opacity-50 hover:opacity-100 transition" 
                 onclick="window.scrollTo({top: window.innerHeight, behavior: 'smooth'});">
                <Icon name="fa6-solid:chevron-down" class="text-3xl"></Icon>
            </div>
        </div>
    )}

    <PostPage page={page}></PostPage>
    <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}></Pagination>
</MainGridLayout>

{isFirstPage && (
    <script>
        import TypeIt from "typeit";
        
        new TypeIt("#hero-typewriter", {
            speed: 60,
            startDelay: 1500,
            loop: true,
            cursor: true,
        })
        .type("æŠ€è¡“å®…æ‹¯æ•‘ä¸–ç•Œ ğŸš€")
        .pause(1500)
        .delete()
        .type("ç†±æ„› iOS & Android å®¢è£½åŒ–")
        .pause(1500)
        .delete()
        .type("æ°¸é ä¿æŒå¥½å¥‡å¿ƒ")
        .pause(2000)
        .delete()
        .go();
    </script>
)}